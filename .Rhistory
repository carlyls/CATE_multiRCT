grepl("tree", Method)==T ~ "Ensemble Tree",
grepl("forest",Method)==T ~ "Ensemble Forest",
grepl("lasso",Method)==T ~ "Ensemble Lasso",
grepl("ma",Method)==T ~ "Meta-Analysis"),
base = factor(base, levels=c("Xlearner", "Slearner", "Causal Forest", "Meta-Analysis")),
ensemble = factor(ensemble, levels=c("Complete Pooling", "Trial Indicator", "Ensemble Tree",
"Ensemble Forest","Ensemble Lasso", "Meta-Analysis")),
sds = paste(study_sd, study_inter_sd, sep=", "), sds = factor(sds),
ns = paste(n_mean, n_sd, sep=", "),
sc_combo = paste(scenario, study_sd, study_inter_sd, sep="_"),
sc_combo = factor(sc_combo))
means_long %>%
rename(Ensemble = ensemble, Base = base) %>%
ggplot(aes(x=sds, y=MSE, group=Method, color=Ensemble)) +
geom_jitter(aes(shape=Base), size=2.5, width=.2, height=0) +
#geom_line() +
facet_wrap(~scenario, scales='free') +
scale_x_discrete(labels = c("Low-Low","Med-Low", "Med-Med", "Med-High","High-High")) +
scale_y_continuous(limits = c(0, 2.1)) +
labs(shape="Single-Study Method", color="Aggregation Method") +
guides(shape=guide_legend(order=1), color=guide_legend(order=2)) +
#theme(axis.text.x = element_text(angle = 45)) +
xlab("SD of Study Main and Study Interaction Coefficients") +
theme(text = element_text(size=14))
means_long %>%
rename(Ensemble = ensemble, Base = base) %>%
mutate(scenario = ifelse(scenario=="1a", "Piecewise Linear CATE",
ifelse(scenario=="1b", "Non-linear CATE",
"Variable CATE"))) %>%
ggplot(aes(x=sds, y=MSE, group=Method, color=Ensemble)) +
geom_jitter(aes(shape=Base), size=2.5, width=.2, height=0) +
#geom_line() +
facet_wrap(~scenario, scales='free') +
scale_x_discrete(labels = c("Low-Low","Med-Low", "Med-Med", "Med-High","High-High")) +
scale_y_continuous(limits = c(0, 2.1)) +
labs(shape="Single-Study Method", color="Aggregation Method") +
guides(shape=guide_legend(order=1), color=guide_legend(order=2)) +
#theme(axis.text.x = element_text(angle = 45)) +
xlab("SD of Study Main and Study Interaction Coefficients") +
theme(text = element_text(size=14))
means_long %>%
rename(Ensemble = ensemble, Base = base) %>%
mutate(scenario = ifelse(scenario=="1a", "Piecewise Linear CATE",
ifelse(scenario=="1b", "Non-linear CATE",
"Variable CATE")),
scenario = factor(scenario, levels=c("Piecewise Linear CATE",
"Non-linear CATE",
"Variable CATE"))) %>%
ggplot(aes(x=sds, y=MSE, group=Method, color=Ensemble)) +
geom_jitter(aes(shape=Base), size=2.5, width=.2, height=0) +
#geom_line() +
facet_wrap(~scenario, scales='free') +
scale_x_discrete(labels = c("Low-Low","Med-Low", "Med-Med", "Med-High","High-High")) +
scale_y_continuous(limits = c(0, 2.1)) +
labs(shape="Single-Study Method", color="Aggregation Method") +
guides(shape=guide_legend(order=1), color=guide_legend(order=2)) +
#theme(axis.text.x = element_text(angle = 45)) +
xlab("SD of Study Main and Study Interaction Coefficients") +
theme(text = element_text(size=14))
means_long %>%
rename(Ensemble = ensemble, Base = base) %>%
mutate(scenario = ifelse(scenario=="1a", "Piecewise Linear CATE",
ifelse(scenario=="1b", "Non-linear CATE",
"Variable CATE")),
scenario = factor(scenario, levels=c("Piecewise Linear CATE",
"Non-linear CATE",
"Variable CATE"))) %>%
ggplot(aes(x=sds, y=MSE, group=Method, color=Ensemble)) +
geom_jitter(aes(shape=Base), size=2.5, width=.2, height=0) +
#geom_line() +
facet_wrap(~scenario, scales='free') +
scale_x_discrete(labels = c("Low-Low","Med-Low", "Med-Med", "Med-High","High-High")) +
scale_y_continuous(limits = c(0, 2.1)) +
labs(shape="Single-Study Method", color="Aggregation Method") +
guides(shape=guide_legend(order=1), color=guide_legend(order=2)) +
#theme(axis.text.x = element_text(angle = 45)) +
xlab("SD of Study Main and Study Interaction Coefficients") +
theme(text = element_text(size=12))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
read_files <- function (dir) {
setwd(dir)
files <- list.files(pattern="_output_")
mylist <- lapply(files, function(x) {
load(file = x)
get(ls()[ls()!= "filename"])
})
all <- do.call("bind_rows", mylist)
return(all)
}
#load in files
all <- read_files("~/Desktop/Cluster/29JulResults_Scenarios") #this is everything except a few of the scenario 3 iterations
#View(all)
fixed <- readRDS("~/Desktop/Cluster/29JulResults_Scenarios_Fixed/sim_output_sc13early.Rdata") #remaining scenario 3 iterations from the "29JulResults_Scenarios_Fixed" folder where I fixed the seed
all <- bind_rows(all, fixed)
nrow(all) #to make sure every iteration ran
nrow(all %>% select(-iteration) %>% distinct())
length(unique(all$seed)) #to make sure there are no duplicates
#checking number of iterations
sum(all$scenario==3, na.rm=T)
sum(all$lin==T, na.rm=T)
sum(all$lin==F, na.rm=T)
all <- all %>%
filter(is.na(scenario)==T | scenario==3) %>%
mutate(scenario = ifelse(is.na(scenario)==F, "2",
ifelse(lin==T, "1a", "1b")),
scenario = factor(scenario, levels=c("1a","1b","2")),
sc_combo = paste(scenario, study_sd, study_inter_sd, sep="_"),
sc_combo = factor(sc_combo)) %>%
select(-c(lin, study_mean, study_inter_mean))
table(all$sc_combo)
#set up settings
settings<-expand.grid(K=c(10),
n_mean=c(500),
n_sd=c(0),
study_sds=c("0.5,0", "1,0", "1,0.5",
"1,1", "3,1"),
scenario=c("1a","1b")) %>%
separate(study_sds, into=c("study_sd", "study_inter_sd"), sep=",") %>%
mutate(study_sd = as.numeric(study_sd),
study_inter_sd = as.numeric(study_inter_sd),
scenario = factor(scenario, levels=c("1a","1b","2"))) %>%
rbind(c(K=10, n_mean=500, n_sd=0, study_sd=NA, study_inter_sd=NA, scenario=2)) %>%
mutate(best_col = NA, num_iter = NA)
#make columns for mses
for (i in 1:16) {
settings <- mutate(settings,
name = "NA")
colnames(settings)[length(colnames(settings))] <- colnames(all)[i]
}
#add results in
mean_mses <- sd_mses <- settings
for (i in 1:nrow(mean_mses)) {
if (mean_mses$scenario[i] %in% c("1a","1b")) {
sim_subset <- filter(all, K==mean_mses$K[i], n_mean==mean_mses$n_mean[i], n_sd==mean_mses$n_sd[i],
study_sd==mean_mses$study_sd[i], study_inter_sd==mean_mses$study_inter_sd[i],
scenario==mean_mses$scenario[i]) %>% select(1:16)
} else {
sim_subset <- filter(all, K==mean_mses$K[i], n_mean==mean_mses$n_mean[i], n_sd==mean_mses$n_sd[i],
scenario==mean_mses$scenario[i]) %>% select(1:16)
}
col_means <- colMeans(sim_subset)
col_sds <- apply(sim_subset,2,sd)
mean_mses[i,"best_col"] <- sd_mses[i,"best_col"] <- names(which.min(col_means))
mean_mses[i,"num_iter"] <- sd_mses[i,"num_iter"] <- nrow(sim_subset)
mean_mses[i, grep("x_nostudy",colnames(mean_mses)):ncol(mean_mses)] <- round(col_means,4)
sd_mses[i, grep("x_nostudy",colnames(mean_mses)):ncol(mean_mses)] <- paste(round(col_means,2), " (",
round(col_sds,2), ")", sep="")
}
#make long data for plotting
means_long <- mean_mses %>%
pivot_longer(cols=x_nostudy:ma,
names_to="Method",
values_to="MSE") %>%
mutate(MSE = as.numeric(MSE),
Method = factor(Method, levels=c("x_nostudy","s_nostudy","causal_nostudy",
"x_studyind","s_studyind","causal_studyind",
"x_tree","s_tree","causal_tree",
"x_forest","s_forest","causal_forest",
"x_lasso","s_lasso","causal_lasso","ma")),
base = case_when(grepl("x_",Method)==T ~ "Xlearner",
grepl("s_",Method)==T ~ "Slearner",
grepl("causal_",Method)==T ~ "Causal Forest",
grepl("ma",Method)==T ~ "Meta-Analysis"),
ensemble = case_when(grepl("nostudy",Method)==T ~ "Complete Pooling",
grepl("studyind",Method)==T ~ "Trial Indicator",
grepl("tree", Method)==T ~ "Ensemble Tree",
grepl("forest",Method)==T ~ "Ensemble Forest",
grepl("lasso",Method)==T ~ "Ensemble Lasso",
grepl("ma",Method)==T ~ "Meta-Analysis"),
base = factor(base, levels=c("Xlearner", "Slearner", "Causal Forest", "Meta-Analysis")),
ensemble = factor(ensemble, levels=c("Complete Pooling", "Trial Indicator", "Ensemble Tree",
"Ensemble Forest","Ensemble Lasso", "Meta-Analysis")),
sds = paste(study_sd, study_inter_sd, sep=", "), sds = factor(sds),
ns = paste(n_mean, n_sd, sep=", "),
sc_combo = paste(scenario, study_sd, study_inter_sd, sep="_"),
sc_combo = factor(sc_combo))
means_long %>%
group_by(Method, ensemble, base) %>%
summarise(MSE=mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, group=1, color=base)) +
geom_point(size=5) +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15)) +
labs(color="Single-Study Approach") +
xlab("Aggregation Approach")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
read_files <- function (dir) {
setwd(dir)
files <- list.files(pattern="_output_")
mylist <- lapply(files, function(x) {
load(file = x)
get(ls()[ls()!= "filename"])
})
all <- do.call("bind_rows", mylist)
return(all)
}
#load in files
all <- read_files("~/Desktop/Cluster/29JulResults_Scenarios") #this is everything except a few of the scenario 3 iterations
#View(all)
fixed <- readRDS("~/Desktop/Cluster/29JulResults_Scenarios_Fixed/sim_output_sc13early.Rdata") #remaining scenario 3 iterations from the "29JulResults_Scenarios_Fixed" folder where I fixed the seed
all <- bind_rows(all, fixed)
nrow(all) #to make sure every iteration ran
nrow(all %>% select(-iteration) %>% distinct())
length(unique(all$seed)) #to make sure there are no duplicates
#checking number of iterations
sum(all$scenario==3, na.rm=T)
sum(all$lin==T, na.rm=T)
sum(all$lin==F, na.rm=T)
all <- all %>%
filter(is.na(scenario)==T | scenario==3) %>%
mutate(scenario = ifelse(is.na(scenario)==F, "2",
ifelse(lin==T, "1a", "1b")),
scenario = factor(scenario, levels=c("1a","1b","2")),
sc_combo = paste(scenario, study_sd, study_inter_sd, sep="_"),
sc_combo = factor(sc_combo)) %>%
select(-c(lin, study_mean, study_inter_mean))
table(all$sc_combo)
#set up settings
settings<-expand.grid(K=c(10),
n_mean=c(500),
n_sd=c(0),
study_sds=c("0.5,0", "1,0", "1,0.5",
"1,1", "3,1"),
scenario=c("1a","1b")) %>%
separate(study_sds, into=c("study_sd", "study_inter_sd"), sep=",") %>%
mutate(study_sd = as.numeric(study_sd),
study_inter_sd = as.numeric(study_inter_sd),
scenario = factor(scenario, levels=c("1a","1b","2"))) %>%
rbind(c(K=10, n_mean=500, n_sd=0, study_sd=NA, study_inter_sd=NA, scenario=2)) %>%
mutate(best_col = NA, num_iter = NA)
#make columns for mses
for (i in 1:16) {
settings <- mutate(settings,
name = "NA")
colnames(settings)[length(colnames(settings))] <- colnames(all)[i]
}
#add results in
mean_mses <- sd_mses <- settings
for (i in 1:nrow(mean_mses)) {
if (mean_mses$scenario[i] %in% c("1a","1b")) {
sim_subset <- filter(all, K==mean_mses$K[i], n_mean==mean_mses$n_mean[i], n_sd==mean_mses$n_sd[i],
study_sd==mean_mses$study_sd[i], study_inter_sd==mean_mses$study_inter_sd[i],
scenario==mean_mses$scenario[i]) %>% select(1:16)
} else {
sim_subset <- filter(all, K==mean_mses$K[i], n_mean==mean_mses$n_mean[i], n_sd==mean_mses$n_sd[i],
scenario==mean_mses$scenario[i]) %>% select(1:16)
}
col_means <- colMeans(sim_subset)
col_sds <- apply(sim_subset,2,sd)
mean_mses[i,"best_col"] <- sd_mses[i,"best_col"] <- names(which.min(col_means))
mean_mses[i,"num_iter"] <- sd_mses[i,"num_iter"] <- nrow(sim_subset)
mean_mses[i, grep("x_nostudy",colnames(mean_mses)):ncol(mean_mses)] <- round(col_means,4)
sd_mses[i, grep("x_nostudy",colnames(mean_mses)):ncol(mean_mses)] <- paste(round(col_means,2), " (",
round(col_sds,2), ")", sep="")
}
#make long data for plotting
means_long <- mean_mses %>%
pivot_longer(cols=x_nostudy:ma,
names_to="Method",
values_to="MSE") %>%
mutate(MSE = as.numeric(MSE),
Method = factor(Method, levels=c("x_nostudy","s_nostudy","causal_nostudy",
"x_studyind","s_studyind","causal_studyind",
"x_tree","s_tree","causal_tree",
"x_forest","s_forest","causal_forest",
"x_lasso","s_lasso","causal_lasso","ma")),
base = case_when(grepl("x_",Method)==T ~ "Xlearner",
grepl("s_",Method)==T ~ "Slearner",
grepl("causal_",Method)==T ~ "Causal Forest",
grepl("ma",Method)==T ~ "Meta-Analysis"),
ensemble = case_when(grepl("nostudy",Method)==T ~ "Complete Pooling",
grepl("studyind",Method)==T ~ "Trial Indicator",
grepl("tree", Method)==T ~ "Ensemble Tree",
grepl("forest",Method)==T ~ "Ensemble Forest",
grepl("lasso",Method)==T ~ "Ensemble Lasso",
grepl("ma",Method)==T ~ "Meta-Analysis"),
base = factor(base, levels=c("Xlearner", "Slearner", "Causal Forest", "Meta-Analysis")),
ensemble = factor(ensemble, levels=c("Complete Pooling", "Trial Indicator", "Ensemble Tree",
"Ensemble Forest","Ensemble Lasso", "Meta-Analysis")),
sds = paste(study_sd, study_inter_sd, sep=", "), sds = factor(sds),
ns = paste(n_mean, n_sd, sep=", "),
sc_combo = paste(scenario, study_sd, study_inter_sd, sep="_"),
sc_combo = factor(sc_combo))
means_long %>%
group_by(Method, ensemble, base) %>%
summarise(MSE=mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, group=1, color=base)) +
geom_point(size=5) +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15)) +
labs(color="Single-Study Approach") +
xlab("Aggregation Approach")
means_long
means_long %>%
filter(base=="Causal Forest") %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15)) +
labs(fill="Aggregation Approach") +
xlab("Aggregation Approach")
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15)) +
labs(fill="Aggregation Approach") +
xlab("Aggregation Approach")
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = ifelse(ensemble=="Trial Indicator", "Pooling with Trial Indicator", ensemble)) %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15)) +
labs(fill="Aggregation Approach") +
xlab("Aggregation Approach")
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = ifelse(ensemble=="Trial Indicator", factor("Pooling with Trial Indicator"), ensemble)) %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15)) +
labs(fill="Aggregation Approach") +
xlab("Aggregation Approach"
)
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15)) +
labs(fill="Aggregation Approach") +
xlab("Aggregation Approach")
typeof(means_long$ensemble)
means_long$ensemble
??unfactor
a <- means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = varhandle::unfactor(ensemble))
a$ensemble
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = varhandle::unfactor(ensemble),
ensemble = ifelse(ensemble == "Trial Indicator",
"Pooling with Trial Indicator", ensemble)) %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15)) +
labs(fill="Aggregation Approach") +
xlab("Aggregation Approach")
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = varhandle::unfactor(ensemble),
ensemble = ifelse(ensemble == "Trial Indicator",
"Pooling with Trial Indicator", ensemble),
ensemble = factor(ensemble, levels=c("Complete Pooling", "Pooling with Trial Indicator","Ensemble Tree","Ensemble Forest","Ensemble Lasso","Meta-Analysis"))) %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15)) +
labs(fill="Aggregation Approach") +
xlab("Aggregation Approach")
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = varhandle::unfactor(ensemble),
ensemble = ifelse(ensemble == "Trial Indicator",
"Pooling with Trial Indicator", ensemble),
ensemble = factor(ensemble, levels=c("Complete Pooling", "Pooling with Trial Indicator","Ensemble Tree","Ensemble Forest","Ensemble Lasso","Meta-Analysis"))) %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15),
legend.position = "none") +
labs(fill="Aggregation Approach") +
xlab("Aggregation Approach")
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = varhandle::unfactor(ensemble),
ensemble = ifelse(ensemble == "Trial Indicator",
"Pooling with Trial Indicator", ensemble),
ensemble = factor(ensemble, levels=c("Complete Pooling", "Pooling with Trial Indicator","Ensemble Tree","Ensemble Forest","Ensemble Lasso","Meta-Analysis"))) %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15),
legend.position = "none") +
labs(fill="Aggregation Approach") +
xlab("Aggregation Approach") +
ggtitle("Average MSE of CATE Estimates for Methods using a Causal Forest with Different Aggregation Approaches")
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = varhandle::unfactor(ensemble),
ensemble = ifelse(ensemble == "Trial Indicator",
"Pooling with Trial Indicator", ensemble),
ensemble = factor(ensemble, levels=c("Complete Pooling", "Pooling with Trial Indicator","Ensemble Tree","Ensemble Forest","Ensemble Lasso","Meta-Analysis"))) %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15),
legend.position = "none",
title = "Average MSE of CATE Estimates by Aggregation Approach",
subtitle = "For Methods using a Causal Forest") +
labs(fill="Aggregation Approach") +
xlab("Aggregation Approach")
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = varhandle::unfactor(ensemble),
ensemble = ifelse(ensemble == "Trial Indicator",
"Pooling with Trial Indicator", ensemble),
ensemble = factor(ensemble, levels=c("Complete Pooling", "Pooling with Trial Indicator","Ensemble Tree","Ensemble Forest","Ensemble Lasso","Meta-Analysis"))) %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15),
legend.position = "none") +
labs(fill="Aggregation Approach",
title = "Average MSE of CATE Estimates by Aggregation Approach",
subtitle = "For Methods using a Causal Forest") +
xlab("Aggregation Approach")
getwd()
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = varhandle::unfactor(ensemble),
ensemble = ifelse(ensemble == "Trial Indicator",
"Pooling with Trial Indicator", ensemble),
ensemble = factor(ensemble, levels=c("Complete Pooling", "Pooling with Trial Indicator","Ensemble Tree","Ensemble Forest","Ensemble Lasso","Meta-Analysis"))) %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15),
legend.position = "none") +
labs(fill="Aggregation Approach",
title = "Average MSE of CATE Estimates by Aggregation Approach",
subtitle = "For Methods using a Causal Forest*",
caption = "*The Meta-Analysis approach did not use a causal forest") +
xlab("Aggregation Approach")
means_long %>%
filter(base=="Causal Forest" | base=="Meta-Analysis") %>%
mutate(ensemble = varhandle::unfactor(ensemble),
ensemble = ifelse(ensemble == "Trial Indicator",
"Pooling with Trial Indicator", ensemble),
ensemble = factor(ensemble, levels=c("Complete Pooling", "Pooling with Trial Indicator","Ensemble Tree","Ensemble Forest","Ensemble Lasso","Meta-Analysis"))) %>%
group_by(ensemble) %>%
summarise(MSE = mean(MSE)) %>%
ggplot(aes(x=ensemble, y=MSE, fill=ensemble)) +
geom_bar(stat="identity") +
theme(axis.text.x = element_text(angle=45, hjust=1, vjust=1),
plot.margin=margin(10,10,10,30),
text = element_text(size=15),
legend.position = "none") +
labs(fill="Aggregation Approach",
title = "Average MSE of CATE Estimates by Aggregation Approach",
subtitle = "For Methods using a Causal Forest") +
xlab("Aggregation Approach")
ggsave("CausalForest_MSEs_Lizpresentation_12Dec2022.jpeg")
install.packages(c("DBI"))
install.packages("RSQLite")
install.packages("dbplyr")
library(dbplyr)
install.packages("RSQLite")
library(RSQLite)
connection <- dbConnect(drv = RSQLite::SQLite(),
dbname = here::here("posts", "2022-12-08-relational-databases", "data", "survey.db"))
covars <- c("X1","X2")
site="Model"
fml <- as.formula(paste(paste(" ~ ", site, " + ", paste(covars, collapse="+")),
paste(site, covars, sep="*", collapse=" + "), sep=" + "))
fml
